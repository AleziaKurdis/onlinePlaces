<!DOCTYPE html>
<!--
//
//  places.html
//
//  Created by Alezia Kurdis, Octyober 20th, 2024.
//  Copyright 2024 Overte e.V.
//
//  online html viewer of Places API.
//
//  Distributed under the Apache License, Version 2.0.
//  See the accompanying file LICENSE or http://www.apache.org/licenses/LICENSE-2.0.html
//
-->
<html>
    <head>
        <meta charset="utf-8">
        <title>Places</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="fonts.css">
        <link rel="stylesheet" href="places.css">
        <script>
            var thisPageName = "places.html";        
            var currentPath = window.location.protocol + "//" + window.location.host + window.location.pathname;
            var ROOTPATH = currentPath.replace(thisPageName, "");
            
            var placeList = [];
            var currentLocation = "";
            var warning = "";
            var metaverseList = [];

            var lifeOnlyFilter = false;
            
            var localFilter = true;
            var federationFilter = true;
            var externalFilter = true; 
            
            var maturityFilter = ["adult", "mature", "teen", "everyone", "unrated"];
            var seachedFieldsFilter = ["name", "description", "owners", "tags"];
            
            var NUMBER_OF_RECORDS_PER_LOAD = 20;
            var loadRecordsUpTo = NUMBER_OF_RECORDS_PER_LOAD;
            var currentListFormat = "PLACES";
        </script>
    </head>
    <body>
        <div id="toolbar">
            <table id='navigationBarContainer'>
                <tr valign = 'middle'>
                    <td width = '100%'>
                        <table id='searchTableExternal'>
                            <tr>
                                <td width='100%'>
                                    <div id='searchFrame'>
                                        <table id='searchTable'>
                                            <tr>
                                                <td width='90%' align='right'><input id='search' placeholder= 'Search / Visit' type = 'text' onkeyup = 'filterSearch();'></td>
                                                <td width='10%'><a href="javascript:void(0)" id='clearBtn' onClick = 'clearSearch();'>&times;</a></td>
                                            </tr>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
            <div id='filters'>
                <div id="searchFiltersBar">
                <button title="Name" class='fieldsSearchFilterOn' id='searchFilterName' onClick = 'filterSearchField("name");'>NAME</button>
                <button title="Description" class='fieldsSearchFilterOn' id='searchFilterDesc' onClick = 'filterSearchField("description");'>DESC</button>
                <button title="Owners" class='fieldsSearchFilterOn' id='searchFilterOwners' onClick = 'filterSearchField("owners");'>OWNERS</button>
                <button title="Tags" class='fieldsSearchFilterOn' id='searchFilterTags' onClick = 'filterSearchField("tags");'>TAGS</button>
                &nbsp;&nbsp;&nbsp;
                </div>              
                <button class='filterLifeOff' id='presenceOfLife' onClick = 'filterLifeOnly();'>USERS</button>
                &nbsp;&nbsp;&nbsp;
                <button title="Adult" class='adultFilterOn' id='maturityAdult' onClick = 'filterMaturity("adult");'>A</button>
                <button title="Mature" class='matureFilterOn' id='maturityMature' onClick = 'filterMaturity("mature");'>M</button>
                <button title="Teen" class='teenFilterOn' id='maturityTeen' onClick = 'filterMaturity("teen");'>T</button>
                <button title="Everyone" class='everyoneFilterOn' id='maturityEveryone' onClick = 'filterMaturity("everyone");'>E</button>
                <button title="Unrated" class='unratedFilterOn' id='maturityUnrated' onClick = 'filterMaturity("unrated");'>U</button>
            </div>
            <div id='tabs'>
                <button id='listFormatDomains' class='tabBtn' onclick='displayTab("DOMAINS");'>Domains</button>
                <button id='listFormatPlaces' class='tabBtn' onclick='displayTab("PLACES");' disabled>Places</button>
                
            </div>
        </div>
        <div id='list_content'><br>&nbsp;&nbsp;Loading...</div>
        <div id='listInfo'></div>
        <!--input type = 'text' readonly id='currentLocation'-->
        <div id="placeDetail" class="overlay">
          <a href="javascript:void(0)" class="closebtn" onclick="closeDetail();">&times;</a>
          <div class="overlay-content">
                <img id="placeDetail-image" onclick="closeDetail();" draggable="false">
                <div id="placeDetail-placeName"></div>
                <table width='100%'>
                    <tr valign='top'>
                        <td width='68%'>
                            <div id="placeDetail-managers"></div>
                            <div id="placeDetail-description"></div></td>
                        <td width='3%'>&nbsp;</td>
                        <td id="" width='29%'>
                            
                            <div id="placeDetail-visitBtn-container"></div>
                            <div id="placeDetail-maturity"></div>
                            <div id="placeDetail-placedata">
                                DOMAIN:
                                <div id="placeDetail-domain"></div>
                                <br><br>USERS:<br>
                                <div id="placeDetail-users"></div>
                                <br><br>
                                <div id="placeDetail-capacity"></div>
                                <br><br>
                                REGION:
                                <div id="placeDetail-metaverse"></div>
                                <div id="placeDetail-region"></div>
                            </div>
                        </td>
                    </tr>
                </table>
          </div>
        </div>

        <script>
            //LISTENER FROM JS FILE:
            //"PLACE_DATA"
            function managePlaceData(placeData, metaverseServers) {
                placeList = [];
                placeList = placeData;
                warning = message.warning;
                metaverseList = metaverseServers;
                generateContent();
            }
            
            readyForContent();
            
            function reload() {
                readyForContent();
                closeDetail();
            }
            

            function displayCurrentLocation() {
                loadRecordsUpTo = NUMBER_OF_RECORDS_PER_LOAD;
                document.getElementById("currentLocation").value = currentLocation;
            }

            function sortDomainsOrder(a, b) {
                var orderA = a.domainOrder.toUpperCase();
                var orderB = b.domainOrder.toUpperCase();
                if (orderA > orderB) {
                    return 1;    
                } else if (orderA < orderB) {
                    return -1;
                }
                if (a.domainOrder > b.domainOrder) {
                    return 1;    
                } else if (a.domainOrder < b.domainOrder) {
                    return -1;
                }
                return 0;
            }

            function generateContent() {
                var placeRecords = placeList.slice();

                if (currentListFormat === "DOMAINS") {
                    placeRecords.sort(sortDomainsOrder);
                }

                var currentDomain = "";
                var counter = 0;
                var formatedList = "";

                if (warning !== "") {
                    formatedList = formatedList + "<div class='warningEntry'>";
                    formatedList = formatedList + "<table class='warningTable'>";
                    formatedList = formatedList + "<tr>";
                    formatedList = formatedList + "<td width='5%'>&nbsp;</td>";
                    formatedList = formatedList + "<td width='95%' valign='top' class='warningTitle'>" + warning + "</td>";
                    formatedList = formatedList + "</tr>";
                    formatedList = formatedList + "</table>";
                    formatedList = formatedList + "</div>";                    
                }

                for (var i = 0; i < placeRecords.length; i++) {
                    if (counter === loadRecordsUpTo) {
                        //Display Load More button
                        formatedList = formatedList + "<div id='loadMore'><button id='loadMoreBtn' onClick='loadMore();'>LOAD MORE...</button></div>";
                        break;
                    }


                    /*
                    Here's where you generate the list.
                    This is the data that you can use to build each portal:
                    
                        placeRecords[i].order
                            //String (Just a sequence used to establish the current ordering. 
                            //No expected to be use, the list is already sorted based on it for you when the page get the data.)
                        
                        placeRecords[i].category
                            //STRING (Possible Values: 
                                //"A" = Attraction (places that have a thumbnail to attact trafic)
                                //"Z" = Other (places that have no tumbnail to not attract trafic, since it's not an attraction.)
                                //"Z" = Utilitary things like localhost
                                //The ordering is already sorting the event in top of the list.
                                //You could also have checked if the thumbnail exist or not.
                                
                        placeRecords[i].accessStatus
                            //String (Possible values: FULL/LIFE/NOBODY 
                            //This indicate if there are presence of people or not, and if the domain is full capacity.
                            //This will be used to display "Life" indicator (green) or "Full" (red)
                            
                        placeRecords[i].name
                            //String (This is the name of the Place. We might want a keyword filter based on this content)
                            
                        placeRecords[i].description
                            //String (This is the description of the Place. We might want a keyword filter based on this content)
                            //To display in a place detail tab?
                            
                        placeRecords[i].thumbnail
                            String (This is the url of the place picture)
                            
                        placeRecords[i].maturity
                             String | "unrated", "adult", "mature", "teen", "everyone" (we might want a filter based on that)
                             
                        placeRecords[i].address
                            String (This is the hifi url of the place. To make a teleporter link, use the function teleport(placeID, address))
                            
                        placeRecords[i].current_attendance
                            Number (The number of people currently in the Domain. domain.num_users)
                            
                        placeRecords[i].id
                            String (This is the place ID, this can be used for any external storage)
                            
                        placeRecords[i].visibility
                            String | 'open', 'friends', 'connections', 'private' 
                            (for now only "open" are return by the api, so nothing to do with this. 
                            Eventually, if we could have something to know if Annonymous are allowed, 
                            we could disply but lock the place where anonymous are not welcome, if the connected user is anonnymous. 
                            So they might see an interest to get an account.)
                            
                        placeRecords[i].capacity
                            Number (Would be the max number of user allowed in the targetted domain.)
                            
                        placeRecords[i].tags
                            String: Preformated list of tags
                            
                        placeRecords[i].managers
                            String: Preformated list of owners
                            
                        placeRecords[i].domain
                            String: Name of the domain where the place is.
                            
                        placeRecords[i].domainOrder
                            String: (Just a sequence used to establish the "per Domain" list).
                            
                        placeRecords[i].metaverseServer
                            String: Metaverse server identifier (base url)
                            
                        placeRecords[i].metaverseRegion
                            String: metaverse server regionality: local, federation, external 
                    
                    */
                    var searchedText = document.getElementById("search").value;
                    if (searchedText !== "") {
                        displaySearchFieldsFilter();
                        document.getElementById("searchFiltersBar").style.display = "inline-block";
                    } else {
                        document.getElementById("searchFiltersBar").style.display = "none";
                    }

                    var lowerCasePlaceName = placeRecords[i].name.toLowerCase();
                    var lowerCasePlaceDescription = placeRecords[i].description.toLowerCase();
                    var lowerCasePlaceManagers = placeRecords[i].managers.toLowerCase();
                    var lowerCasePlaceTags = placeRecords[i].tags.toLowerCase();
                    if ((localFilter && placeRecords[i].metaverseRegion === "local") || 
                        (federationFilter && placeRecords[i].metaverseRegion === "federation") || 
                        (externalFilter && placeRecords[i].metaverseRegion === "external")) {
                        if ((lifeOnlyFilter && placeRecords[i].accessStatus !== "NOBODY") || !lifeOnlyFilter) { 
                            if ( maturityFilter.indexOf(placeRecords[i].maturity) !== -1){
                                if ((lowerCasePlaceName.indexOf(searchedText.toLowerCase()) !== -1 && seachedFieldsFilter.indexOf("name") !== -1) ||
                                    (lowerCasePlaceDescription.indexOf(searchedText.toLowerCase()) !== -1 && seachedFieldsFilter.indexOf("description") !== -1) ||
                                    (lowerCasePlaceManagers.indexOf(searchedText.toLowerCase()) !== -1 && seachedFieldsFilter.indexOf("owners") !== -1) ||
                                    (lowerCasePlaceTags.indexOf(searchedText.toLowerCase()) !== -1 && seachedFieldsFilter.indexOf("tags") !== -1) ) { 
                                    
                                    if (currentListFormat === "DOMAINS" && currentDomain !== placeRecords[i].domain) {

                                        var capacity = "?";
                                        if (placeRecords[i].capacity !== 0) {
                                            capacity = placeRecords[i].capacity;
                                        }

                                        //display Domain section
                                        formatedList = formatedList + "<div id='domainEntry' class='domainEntry'>";
                                        formatedList = formatedList + "<table class='domainTable'>";
                                        formatedList = formatedList + "<tr>";
                                        formatedList = formatedList + "<td width='5%'>&nbsp;</td>";
                                        formatedList = formatedList + "<td width='70%' valign='top' class='domainTitle'>" + placeRecords[i].domain + "</td>";
                                        formatedList = formatedList + "<td width='25%' align='right' valign='top'><font class='domain-nbrUser " + placeRecords[i].accessStatus + "'><font class='domain-nbrUser_small'>USERS:</font> " + placeRecords[i].current_attendance + "</font>";
                                        formatedList = formatedList + "<font class='domain-capacity'><br>CAPACITY: " + capacity + "</font></td>";
                                        formatedList = formatedList + "</tr>";
                                        formatedList = formatedList + "</table>";
                                        formatedList = formatedList + "</div>";

                                        currentDomain = placeRecords[i].domain;
                                    }

                                    var moreStyle = "";
                                    if (placeRecords[i].category === "A") {
                                        moreStyle = " style='background-image: url(" + placeRecords[i].thumbnail + "); background-repeat: no-repeat; background-position: 50% 50%; background-size: cover;'";
                                    } else if (placeRecords[i].category === "Z") {
                                        moreStyle = " style='background-color: #364a6e;'";
                                    }
                                    
                                    var maxCharNumber = 55;
                                    if (currentListFormat === "PLACES" && i === 0) {
                                        maxCharNumber = 180;
                                    }
                                    var shortenedDescription = placeRecords[i].description.substr(0, maxCharNumber);
                                    if (shortenedDescription.slice(-1) !== ".") {
                                        shortenedDescription = shortenedDescription + "...";
                                    }

                                    var placeUrl = "hifi://" + placeRecords[i].name;
                                    if (placeRecords[i].metaverseRegion !== "local") {
                                        placeUrl = "hifi://" + placeRecords[i].address;
                                    }
                                    if (placeRecords[i].name === "tutorial") {
                                        placeUrl = "file:///~/serverless/tutorial.json";
                                    }

                                    var promotedblur = "";
                                    var promoted = "";
                                    var placeTitlePromoted = "";
                                    var prompotionDescHeight = "";
                                    if (currentListFormat === "PLACES" && i === 0) {
                                        promotedblur = " promotedblur";
                                        promoted = " placeEntryLargeSize";
                                        placeTitlePromoted = " placeTitlePromoted";
                                        prompotionDescHeight = " style='height: 175px; '";
                                    }
                                    //Add the place to the list

                                    formatedList = formatedList + "<div class = 'placeEntry" + promoted + "' id='place-" + placeRecords[i].id + "'" + moreStyle + "><div class = 'blur" + promotedblur + "'>";
                                    formatedList = formatedList + "<table class='placeTable'>";
                                    formatedList = formatedList + "    <tr valign = 'top'>";
                                    formatedList = formatedList + "        <td width='2%'></td>";                                
                                    formatedList = formatedList + "        <td align='left' width='75%' onclick='teleport(" + '"' + placeRecords[i].id + '"' + ", " + '"' + placeUrl + '"' + "); return false;'><a class= 'placeTitle" + placeTitlePromoted + "' href='javascript:void(0)' onclick='teleport(" + '"' + placeRecords[i].id + '"' + ", " + '"' + placeUrl + '"' + "); return false;'>" + placeRecords[i].name + "</a></td>";
                                    if (placeRecords[i].category !== "Z") {
                                        formatedList = formatedList + "        <td align='right' ><span style='padding: 0%; cursor: pointer;' onclick='openDetail(" + '"' + placeRecords[i].id + '"' + ")'><img src='icons/info.png' width='26' height='26' draggable='false'></span></td>";
                                    }
                                    formatedList = formatedList + "    </tr>";
                                    formatedList = formatedList + "</table>";
                                    if (placeRecords[i].category !== "Z") {
                                        formatedList = formatedList + "<table class='placeTable'" + prompotionDescHeight + ">";
                                        formatedList = formatedList + "    <tr valign = 'bottom'>";
                                        formatedList = formatedList + "        <td width='2%'></td>";
                                        formatedList = formatedList + "        <td align='left' width='88%' class='place-entry-description' onclick='teleport(" + '"' + placeRecords[i].id + '"' + ", " + '"' + placeUrl + '"' + "); return false;'>" + shortenedDescription + "</td>";
                                        formatedList = formatedList + "        <td align='right' class='presenceOfLife-" + placeRecords[i].accessStatus + "'>&#9603;</td>";
                                        formatedList = formatedList + "    </tr>";
                                        formatedList = formatedList + "</table>";
                                    }
                                    formatedList = formatedList + "</div></div>";

                                    counter++;
                                }
                            }
                        }
                    }
                }
                document.getElementById("list_content").innerHTML = formatedList;
                
                var placeInfo = " places";
                if (counter <= 1) {
                    placeInfo = " place";
                }
                document.getElementById("listInfo").innerHTML = counter + placeInfo + " of " + placeRecords.length + ".";
            }

            function loadMore() {
                loadRecordsUpTo = loadRecordsUpTo + NUMBER_OF_RECORDS_PER_LOAD;
                generateContent();
            }

            function filterLifeOnly() {
                if (lifeOnlyFilter) {
                    lifeOnlyFilter = false;
                    document.getElementById("presenceOfLife").className = "filterLifeOff";
                } else {
                    lifeOnlyFilter = true;
                    document.getElementById("presenceOfLife").className = "lifeFilterOn";
                }
                loadRecordsUpTo = NUMBER_OF_RECORDS_PER_LOAD;
                generateContent();
            }

            function filterMaturity(targeted) {
                if (maturityFilter.indexOf(targeted) === -1) {
                    maturityFilter.push(targeted);
                } else {
                    maturityFilter = arrayRemove(maturityFilter, targeted);
                }
                loadRecordsUpTo = NUMBER_OF_RECORDS_PER_LOAD;

                displayMaturityFilter();
                generateContent();
            }

            function filterSearchField(targeted) {
                if (seachedFieldsFilter.indexOf(targeted) === -1) {
                    seachedFieldsFilter.push(targeted);
                } else {
                    seachedFieldsFilter = arrayRemove(seachedFieldsFilter, targeted);
                }
                loadRecordsUpTo = NUMBER_OF_RECORDS_PER_LOAD;
                displaySearchFieldsFilter();
                generateContent();            
            }

            function arrayRemove(arr, value) {
                return arr.filter(function(ele){
                    return ele != value;
                });
            }

            function displayMaturityFilter() {
                if (maturityFilter.indexOf("adult") === -1) {
                    document.getElementById("maturityAdult").className = "filterOff";
                } else {
                    document.getElementById("maturityAdult").className = "adultFilterOn";
                }

                if (maturityFilter.indexOf("mature") === -1) {
                    document.getElementById("maturityMature").className = "filterOff";
                } else {
                    document.getElementById("maturityMature").className = "matureFilterOn";
                } 
                
                if (maturityFilter.indexOf("teen") === -1) {
                    document.getElementById("maturityTeen").className = "filterOff";
                } else {
                    document.getElementById("maturityTeen").className = "teenFilterOn";
                }

                if (maturityFilter.indexOf("everyone") === -1) {
                    document.getElementById("maturityEveryone").className = "filterOff";
                } else {
                    document.getElementById("maturityEveryone").className = "everyoneFilterOn";
                }

                if (maturityFilter.indexOf("unrated") === -1) {
                    document.getElementById("maturityUnrated").className = "filterOff";
                } else {
                    document.getElementById("maturityUnrated").className = "unratedFilterOn";
                }
            }

            function displaySearchFieldsFilter() {
                if (seachedFieldsFilter.indexOf("name") === -1) {
                    document.getElementById("searchFilterName").className = "fieldsSearchFilterOff";
                } else {
                    document.getElementById("searchFilterName").className = "fieldsSearchFilterOn";
                }

                if (seachedFieldsFilter.indexOf("description") === -1) {
                    document.getElementById("searchFilterDesc").className = "fieldsSearchFilterOff";
                } else {
                    document.getElementById("searchFilterDesc").className = "fieldsSearchFilterOn";
                }
                
                if (seachedFieldsFilter.indexOf("owners") === -1) {
                    document.getElementById("searchFilterOwners").className = "fieldsSearchFilterOff";
                } else {
                    document.getElementById("searchFilterOwners").className = "fieldsSearchFilterOn";
                }
                
                if (seachedFieldsFilter.indexOf("tags") === -1) {
                    document.getElementById("searchFilterTags").className = "fieldsSearchFilterOff";
                } else {
                    document.getElementById("searchFilterTags").className = "fieldsSearchFilterOn";
                }

            }

            function filterSearch() {
                document.getElementById("clearBtn").style.display = "block";
                loadRecordsUpTo = NUMBER_OF_RECORDS_PER_LOAD;
                generateContent();
            }

            function clearSearch() {
                document.getElementById("search").value = "";
                document.getElementById("clearBtn").style.display = "none";
                loadRecordsUpTo = NUMBER_OF_RECORDS_PER_LOAD;
                generateContent();
            }

            function displayTab(tab) {
                currentListFormat = tab;
                if (tab === "PLACES") {
                    document.getElementById("listFormatPlaces").disabled = true;
                    document.getElementById("listFormatDomains").disabled = false;
                    document.getElementById("listFormatMetaverse").disabled = false;
                } else if (tab === "DOMAINS") {
                    document.getElementById("listFormatPlaces").disabled = false;
                    document.getElementById("listFormatDomains").disabled = true;
                    document.getElementById("listFormatMetaverse").disabled = false;
                }

                loadRecordsUpTo = NUMBER_OF_RECORDS_PER_LOAD;
                generateContent();
            }


            function openDetail(placeId) {
                for (var k=0; k < placeList.length; k++) {
                    if (placeList[k].id === placeId) {
                        var placeDetail = placeList[k];
                        break;
                    }
                }

                document.getElementById("placeDetail-image").src = "";
                if (placeDetail.thumbnail === "") {
                    document.getElementById("placeDetail-image").src = "icons/placeholder_" + placeDetail.metaverseRegion + ".jpg";
                } else {
                    document.getElementById("placeDetail-image").src = placeDetail.thumbnail;
                }
                document.getElementById("placeDetail-placeName").innerHTML = placeDetail.name;
                document.getElementById("placeDetail-managers").innerHTML = "By <br>&nbsp;&nbsp;&nbsp;&nbsp;" + placeDetail.managers;
                document.getElementById("placeDetail-description").innerHTML = placeDetail.description;

                var placeUrl = "hifi://" + placeDetail.name;
                if (placeDetail.metaverseRegion !== "local") {
                    placeUrl = "hifi://" + placeDetail.address;
                }                
                document.getElementById("placeDetail-visitBtn-container").innerHTML = "<button id='placeDetail-visitBtn' onclick='teleport(" + '"' + placeDetail.id + '"' + ", " + '"' + placeUrl + '"' + "); return false;'>Visit</button>";
                document.getElementById("placeDetail-maturity").innerHTML = placeDetail.maturity.toUpperCase();
                document.getElementById("placeDetail-maturity").className = placeDetail.maturity + "FilterOn placeMaturity";
                document.getElementById("placeDetail-domain").innerHTML = placeDetail.domain.toUpperCase();
                document.getElementById("placeDetail-users").innerHTML = "<font class='" + placeDetail.accessStatus + "'>" + placeDetail.current_attendance + "</font>";
                var capacity = "UNDEFINED";
                if (placeDetail.capacity !== 0) {
                    capacity = placeDetail.capacity;
                }
                document.getElementById("placeDetail-capacity").innerHTML = "CAPACITY: <b>" + capacity + "</b>";
                document.getElementById("placeDetail-metaverse").innerHTML = "<font class='region-" + placeDetail.metaverseRegion.toUpperCase() + "'>" + placeDetail.metaverseServer + "</font>";
                document.getElementById("placeDetail-region").innerHTML = "<font class='region-" + placeDetail.metaverseRegion.toUpperCase() + "'>" + placeDetail.metaverseRegion.toUpperCase() + "</font>";

                document.getElementById("placeDetail").style.width = "100%";
            }

            function closeDetail() {
                document.getElementById("placeDetail").style.width = "0%";
            }

            function sleepFor( milliseconds ){
                var now = new Date().getTime();
                while(new Date().getTime() < now + milliseconds){ /* do nothing */ } 
            }                      


        //###################################################################################
        //###################################################################################
        //#####################         FETCH AND PREPROCESS           ######################
        //###################################################################################
        //###################################################################################
        
                var METAVERSE_SERVER_URL = "https://mv.overte.org/server";
                var REQUEST_TIMEOUT = 10000; //10 seconds

                var httpRequest = null;
                var placesData;
                var portalList = [];

                var PERSISTENCE_ORDERING_CYCLE = 5 * 24 * 3600 * 1000; //5 days

                function readyForContent() {
                    transmitPortalList();
                }
                

                function transmitPortalList() {
                    portalList = [];
                    var extractedData;

                    extractedData = getContent(METAVERSE_SERVER_URL + "/api/v1/places?status=online&per_page=1000");
                    alert(JSON.stringify(extractedData));
                    placesData = JSON.parse(extractedData);
                    processData();
                    
                    addUtilityPortals();
                    
                    portalList.sort(sortOrder);
                    
                    managePlaceData(portalList);
                };

                function getContent(url) {
                    fetch(url)
                    .then(x => x.text())
                    .then(y => contentProcess(y));
                }
                
                function contentProcess(y) {
                    return y;
                }
                
                function processData(){
                    var places = placesData.data.places;
                    for (var i = 0;i < places.length; i++) {

                        var region, category, accessStatus;
                        
                        var description = (places[i].description ? places[i].description : "");
                        var thumbnail = (places[i].thumbnail ? places[i].thumbnail : "");
                              
                            region = "0";

                            if ( thumbnail.substr(0, 4).toLocaleLowerCase() !== "http") {
                                category = "O"; //Other
                            } else {
                                category = "A"; //Attraction                        
                            }
                            
                            if (places[i].domain.num_users > 0) {
                                if (places[i].domain.num_users >= places[i].domain.capacity && places[i].domain.capacity !== 0) {
                                    accessStatus = "FULL";
                                } else {
                                    accessStatus = "LIFE";
                                }
                            } else {
                                accessStatus = "NOBODY";
                            }                 

                            var portal = {
                                "order": category + "_" + region + "_" + getSeededRandomForString(places[i].id),
                                "category": category,
                                "accessStatus": accessStatus,
                                "name": places[i].name,
                                "description": description,
                                "thumbnail": thumbnail,
                                "maturity": places[i].maturity,
                                "address": places[i].address,
                                "current_attendance": places[i].domain.num_users,
                                "id": places[i].id,
                                "visibility": places[i].visibility,
                                "capacity": places[i].domain.capacity,
                                "tags": getListFromArray(places[i].tags),
                                "managers": getListFromArray(places[i].managers),
                                "domain": places[i].domain.name,
                                "domainOrder": aplphabetize(zeroPad(places[i].domain.num_users, 6)) + "_" + places[i].domain.name + "_" + places[i].name,
                                "metaverseServer": METAVERSE_SERVER_URL,
                                "metaverseRegion": "local"
                            };
                            portalList.push(portal);


                    }

                
                }

                function addUtilityPortals() {
                    var localHostPortal = {
                        "order": "Z_Z_AAAAAA",
                        "category": "Z",
                        "accessStatus": "NOBODY",
                        "name": "localhost",
                        "description": "",
                        "thumbnail": "",
                        "maturity": "unrated",
                        "address": "localhost",
                        "current_attendance": 0,
                        "id": "",
                        "visibility": "open",
                        "capacity": 0,
                        "tags": "",
                        "managers": "",
                        "domain": "",
                        "domainOrder": "ZZZZZZZZZZZZZZA",
                        "metaverseServer": "",
                        "metaverseRegion": "local"
                    };
                    portalList.push(localHostPortal);

                    var tutorialPortal = {
                        "order": "Z_Z_AAAAAZ",
                        "category": "Z",
                        "accessStatus": "NOBODY",
                        "name": "tutorial",
                        "description": "",
                        "thumbnail": "",
                        "maturity": "unrated",
                        "address": "file:///~/serverless/tutorial.json",
                        "current_attendance": 0,
                        "id": "",
                        "visibility": "open",
                        "capacity": 0,
                        "tags": "",
                        "managers": "",
                        "domain": "",
                        "domainOrder": "ZZZZZZZZZZZZZZZ",
                        "metaverseServer": "",
                        "metaverseRegion": "local"
                    };
                    portalList.push(tutorialPortal);
                    
                }

                function aplphabetize(num) {
                    var numbstring = num.toString();
                    var newChar = "JIHGFEDCBA";
                    var refChar = "0123456789";
                    var processed = "";
                    for (var j=0; j < numbstring.length; j++) {
                        processed = processed + newChar.substr(refChar.indexOf(numbstring.charAt(j)),1);
                    }
                    return processed;
                }

                function getListFromArray(dataArray) {
                    var dataList = "";
                    if (dataArray !== undefined && dataArray.length > 0) {
                        for (var k = 0; k < dataArray.length; k++) {
                            if (k !== 0) {
                                dataList += ", "; 
                            }
                            dataList += dataArray[k];
                        }
                        if (dataArray.length > 1){
                            dataList += ".";
                        }
                    }
                    
                    return dataList;
                }

                function sortOrder(a, b) {
                    var orderA = a.order.toUpperCase();
                    var orderB = b.order.toUpperCase();
                    if (orderA > orderB) {
                        return 1;    
                    } else if (orderA < orderB) {
                        return -1;
                    }
                    if (a.order > b.order) {
                        return 1;    
                    } else if (a.order < b.order) {
                        return -1;
                    }
                    return 0;
                }

                function zeroPad(num, places) {
                    var zero = places - num.toString().length + 1;
                    return Array(+(zero > 0 && zero)).join("0") + num;
                }

                function getFrequentPlaces(list) {
                    var count = {};
                    list.forEach(function(list) {
                        count[list] = (count[list] || 0) + 1;
                    });
                    return count;
                }

                //####### seed random library ################
                var seed = 75;

                var seededRandom = function(max, min) {
                    max = max || 1;
                    min = min || 0;
                    seed = (seed * 9301 + 49297) % 233280;
                    var rnd = seed / 233280;
                    return min + rnd * (max - min);
                }

                function getStringScore(str) {
                    var score = 0;
                    for (var j = 0; j < str.length; j++){
                        score += str.charAt(j).charCodeAt(0) + 1;
                    }
                    return score;
                }

                function getSeededRandomForString(str) {
                    var score = getStringScore(str);
                    var d = new Date();
                    var n = d.getTime();
                    var currentSeed = Math.floor(n / PERSISTENCE_ORDERING_CYCLE);
                    seed = score * currentSeed;
                    return zeroPad(Math.floor(seededRandom() * 100000),5);
                }
                //####### END of seed random library ################

                displayMaturityFilter();
                document.getElementById("clearBtn").style.display = "none";
                document.getElementById("searchFiltersBar").style.display = "none";

            </script>
    </body>
</html>
